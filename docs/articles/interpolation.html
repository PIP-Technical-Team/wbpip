<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to interpolate between two surveys • wbpip</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to interpolate between two surveys">
<meta property="og:description" content="wbpip">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wbpip</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic_functions.html">Basic functions</a>
    </li>
    <li>
      <a href="../articles/compute_median_using_S3.html">Compute median using S3 system</a>
    </li>
    <li>
      <a href="../articles/compute_pip_stats.html">compute_pip_stats</a>
    </li>
    <li>
      <a href="../articles/compute_SPL.html">compute_SPL</a>
    </li>
    <li>
      <a href="../articles/interpolation.html">How to interpolate between two surveys</a>
    </li>
    <li>
      <a href="../articles/microdata_workflow.html">microdata_workflow</a>
    </li>
    <li>
      <a href="../articles/review_gd_compute_pip_stats.html">review_select_lorenz</a>
    </li>
    <li>
      <a href="../articles/review_lb_code.html">review_lb_code</a>
    </li>
    <li>
      <a href="../articles/review_lq_code.html">review_lq_code</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/PIP-Technical-Team/wbpip/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="interpolation_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to interpolate between two surveys</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PIP-Technical-Team/wbpip/blob/master/vignettes/interpolation.Rmd"><code>vignettes/interpolation.Rmd</code></a></small>
      <div class="hidden name"><code>interpolation.Rmd</code></div>

    </div>

    
    
<p>This vignette explains how to calculate poverty statistics for a common request year for which survey data is not available. Specifically the vignette shows how to interpolate between two surveys from the same country.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PIP-Technical-Team/wbpip">wbpip</a></span><span class="op">)</span></code></pre></div>
<div id="load-and-clean-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-and-clean-data" class="anchor"></a>Load and clean data</h2>
<p>We start off by loading two of the example datasets included in <code>wbpip</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load datasets</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">'md_ABC_2000_income'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">'md_ABC_2010_income'</span><span class="op">)</span></code></pre></div>
<p>We need to clean the datasets to ensure that there aren’t any missing values, and that the welfare values are sorted properly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Clean datasets </span>
<span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">md_ABC_2000_income</span>, <span class="va">md_ABC_2010_income</span><span class="op">)</span>
<span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">dl</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">wbpip</span><span class="fu">:::</span><span class="fu"><a href="../reference/md_clean_data.html">md_clean_data</a></span><span class="op">(</span><span class="va">df</span>, welfare <span class="op">=</span> <span class="st">'welfare'</span>, weight <span class="op">=</span> <span class="st">'weight'</span><span class="op">)</span><span class="op">$</span><span class="va">data</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; i Data has been sorted by variable 'welfare'</span>
<span class="co">#&gt; i 30 NA values in variable 'welfare' were dropped</span>
<span class="co">#&gt; i Data has been sorted by variable 'welfare'</span></code></pre></div>
</div>
<div id="calculate-survey-means" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-survey-means" class="anchor"></a>Calculate survey means</h2>
<p>We then calculate the weighted mean for both surveys. Note that welfare values for each survey are given in local currency units so we add <code>_lcu</code> as a suffix to the vector. This is helpful to distinguish these values from other conversions later on.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate survey mean (in local currency units)</span>
<span class="va">svy_mean_lcu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">dl</span>, FUN.VALUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">welfare</span>, <span class="va">df</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">svy_mean_lcu</span><span class="op">)</span>
<span class="co">#&gt; [1] 3436146 7186782</span></code></pre></div>
<p>These survey means might look like they are very large, but that is because the underlying welfare values are reported in yearly values. Since international poverty lines are reported in (international) dollars per day, the survey mean also needs to be converted to daily values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert to daily values </span>
<span class="va">svy_mean_lcu</span> <span class="op">&lt;-</span> <span class="va">svy_mean_lcu</span> <span class="op">/</span> <span class="fl">365</span> </code></pre></div>
</div>
<div id="convert-to-ppp-adjusted-dollars" class="section level2">
<h2 class="hasAnchor">
<a href="#convert-to-ppp-adjusted-dollars" class="anchor"></a>Convert to PPP-adjusted dollars</h2>
<p>In order for poverty statistics to be comparable over time and across countries we also need to make sure that the survey means are adjusted to take different price levels into account. This can be done by converting them into purchasing power parity (PPP) adjusted dollars.</p>
<p>We thus create a new vector, <code>svy_mean_ppp,</code> by using the function <code><a href="../reference/deflate_welfare_mean.html">deflate_welfare_mean()</a></code> to adjust the values. Here we imagine a PPP value of 1081, a CPI value for the first survey year of 0.6 and a CPI value for the second survey year of 0.9. The CPI is based on the PPP year, meaning that if the PPP exchange rate is provided to year 2011, then the CPI value for 2011 will be 1 (if we except cases for which 2011 saw a change if currency).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svy_mean_ppp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deflate_welfare_mean.html">deflate_welfare_mean</a></span><span class="op">(</span>
  welfare_mean <span class="op">=</span> <span class="va">svy_mean_lcu</span>, 
  ppp <span class="op">=</span> <span class="fl">1081</span>, 
  cpi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">svy_mean_ppp</span><span class="op">)</span>
<span class="co">#&gt; [1] 14.51449 20.23827</span></code></pre></div>
<p>This gives us a daily welfare mean of $14.5 in 2000 and a welfare mean of $20.2 in 2010.</p>
</div>
<div id="calculate-the-predicted-mean-for-the-request-year" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-the-predicted-mean-for-the-request-year" class="anchor"></a>Calculate the predicted mean for the request year</h2>
<p>We are now almost ready to calculate poverty statistics for the year we are interested in, but there is one final step we need to conduct first. We need to predict the value of the daily welfare mean for the request year (Year for which there is no availble survey). For this prediction, national accounts data, e.g. the Gross Domestic Product (GDP) or Household Final Consumption Expenditure (HFCE), are used for to approximate the growth of the daily welfare mean.</p>
<p>Let’s imagine that we are calculating poverty statistics for the year 2005, and that we are using GDP data as proxy values. Then we would need three GDP values; one for the first survey year (2000), one for the second survey year (2010) and one for the request year (2005).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predict welfare means for the request year</span>
<span class="va">pred_mean_ppp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_request_year_mean.html">predict_request_year_mean</a></span><span class="op">(</span>
  survey_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2010</span><span class="op">)</span>, 
  survey_mean <span class="op">=</span> <span class="va">svy_mean_ppp</span>,
  proxy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    value0 <span class="op">=</span> <span class="fl">1200</span>, value1 <span class="op">=</span> <span class="fl">1900</span>, req_value <span class="op">=</span> <span class="fl">1500</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pred_mean_ppp</span><span class="op">)</span>
<span class="co">#&gt; [1] 16.96754 16.96754</span></code></pre></div>
<p>We see that the two predicted survey means are identical. That is because all the supplied GDP values are moving in the same direction, implying that same-direction interpolation was used to compute the predicted means.</p>
</div>
<div id="calculate-poverty-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-poverty-statistics" class="anchor"></a>Calculate poverty statistics</h2>
<p>We now have all the information we need to calculate poverty statistics for the request year.</p>
<p>The function <code><a href="../reference/fill_gaps.html">fill_gaps()</a></code> takes the following main arguments;</p>
<ul>
<li><p><code>request_year</code>: An integer value for the request year.</p></li>
<li><p><code>data</code>: A list with one or two country-year datasets.</p></li>
<li><p><code>predicted_request_mean</code> : A numeric vector with predicted mean(s) for the request year.</p></li>
<li><p><code>survey_year</code>: A numeric vector with the survey year(s).</p></li>
</ul>
<p>In addition you will also need to specify the type of data you are using (micro or grouped) and which value you are using for the poverty line.</p>
<p>In this case we supply the cleaned datasets, predicted means and survey year for both surveys since want to interpolate between them. We then also supply 2005 as the request year, $1.9 for the poverty line and specify the data type as <code>micro</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate poverty statitics for 2005 </span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fill_gaps.html">fill_gaps</a></span><span class="op">(</span>
  request_year <span class="op">=</span> <span class="fl">2005</span>,
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>df0 <span class="op">=</span> <span class="va">dl</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, df1 <span class="op">=</span> <span class="va">dl</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
  predicted_request_mean <span class="op">=</span> <span class="va">pred_mean_ppp</span>,
  survey_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2010</span><span class="op">)</span>, 
  default_ppp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,  
  distribution_type <span class="op">=</span> <span class="st">'micro'</span>,
  poverty_line <span class="op">=</span> <span class="fl">1.9</span><span class="op">)</span> </code></pre></div>
<p>The function returns a list of different poverty statistics, including the estimated welfare mean, headcount, poverty gap and poverty severity. Note that all distributional statistics (e.g. the Gini, Mean Log Deviation etc.) are set to NA since it does not make sense to calculate these when <em>interpolating</em> between two surveys.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">#&gt; List of 11</span>
<span class="co">#&gt;  $ poverty_line    : num 1.9</span>
<span class="co">#&gt;  $ mean            : num 17</span>
<span class="co">#&gt;  $ median          : logi NA</span>
<span class="co">#&gt;  $ headcount       : num 0.0256</span>
<span class="co">#&gt;  $ poverty_gap     : num 0.00952</span>
<span class="co">#&gt;  $ poverty_severity: num 0.00532</span>
<span class="co">#&gt;  $ watts           : num 0.0114</span>
<span class="co">#&gt;  $ gini            : logi NA</span>
<span class="co">#&gt;  $ mld             : logi NA</span>
<span class="co">#&gt;  $ polarization    : logi NA</span>
<span class="co">#&gt;  $ deciles         : logi NA</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tony Fujs, Aleksander Eilertsen, R. Andrés Castañeda, Ifeanyi Nzegwu Edochie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
